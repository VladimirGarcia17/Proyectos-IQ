import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt

#Cargar dataset
df = pd.read_excel('D:\Python\Proceso Qu√≠mico\datos_proceso.xlsx')

#Vista r√°pida
print(df.head())

#Asegurar que Tiempo sea datetime
df['Tiempo'] = pd.to_datetime(df['Tiempo'])

#Visualizaci√≥n Temperatura con respecto al Tiempo
plt.figure(figsize=(10,5))
plt.plot(df['Tiempo'], df['Temperatura (¬∞C)'], label='Temperatura')
plt.xlabel('Tiempo')
plt.ylabel('Temperatura (¬∞C)')
plt.title('Temperatura vs Tiempo')
plt.legend()
plt.grid()
plt.show()

#Detecci√≥n de anomal√≠as en presi√≥n
presion_media = df['Presi√≥n (bar)'].mean()
presion_std = df['Presi√≥n (bar)'].std()

df['Presi√≥n_An√≥mala'] = abs(df['Presi√≥n (bar)'] - presion_media) > 3 * presion_std

#Detecci√≥n de anomal√≠as en concentraci√≥n
df['Concentraci√≥n_An√≥mala'] = df['Concentraci√≥n (% w/w)'] < 97

#Combinar anomal√≠as
df['Anomal√≠a'] = df['Presi√≥n_An√≥mala'] | df['Concentraci√≥n_An√≥mala']

#Filtrar anomal√≠as encontradas
anomal√≠as = df[df['Anomal√≠a'] == True]

#Mostrar anomal√≠as
print(anomal√≠as[['Tiempo', 'Presi√≥n (bar)', 'Concentraci√≥n (% w/w)', 'Anomal√≠a']])

#Mostrar cantidad total de anomal√≠as  
print(f"üîç Total de anomal√≠as detectadas: {anomal√≠as.shape[0]}")

#Resaltar anomal√≠as en la gr√°fica
plt.figure(figsize=(10,5))

#Gr√°fica de temperatura normal
sns.lineplot(data=df, x='Tiempo', y='Temperatura (¬∞C)', label='Temperatura', color='blue')

#Puntos de anomal√≠as
plt.scatter(anomal√≠as['Tiempo'], anomal√≠as['Temperatura (¬∞C)'], color='red', label='Anomal√≠as', zorder=5)

plt.xlabel('Tiempo')
plt.ylabel('Temperatura (¬∞C)')
plt.title('Temperatura vs Tiempo con Anomal√≠as')
plt.legend()
plt.grid()
plt.show()

#Exportar reporte a Excel (2 hojas)
with pd.ExcelWriter('reporte_analisis_proceso.xlsx', engine='xlsxwriter') as writer:
    df.to_excel(writer, sheet_name='Datos_Limpios', index=False)
    anomal√≠as.to_excel(writer, sheet_name='Anomal√≠as', index=False)

print("‚úÖ Reporte generado: 'reporte_analisis_proceso.xlsx'")
